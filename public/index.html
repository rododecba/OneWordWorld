<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LIBRE</title>
  
  <link rel="icon" type="image/png" href="logolibre-favicon.png?v=1">
  <link rel="apple-touch-icon" href="logolibre-favicon.png?v=1">

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    html { scroll-behavior: smooth; transition: background-color 0.3s, color 0.3s; }
    .logo-hidden { opacity: 0; transition: opacity 1.5s; }
    .logo-shown { opacity: 1; transition: opacity 1.5s; }
    #logolibre { opacity: 0; transition: opacity 1.5s; }
    #logolibre.visible { opacity: 1; transition: opacity 1.5s; }
    #map { width: 100%; height: 250px; border-radius: 1rem; margin-bottom: 1rem; }
    .pagination { display: flex; gap: 8px; justify-content: center; margin: 10px 0; }
    .pagination button { background: #e5e7eb; border-radius: 6px; padding: 4px 10px; font-size: 0.9rem; }
    .pagination button[disabled] { opacity: 0.5; cursor: not-allowed; }
    .reply-box { background: #fafafa; border-radius: 1rem; padding: 0.75rem; border: 1px solid #e5e7eb; margin-top: 0.5rem; }
    .action-btn { font-size: 0.8rem; color: #6d28d9; background: none; border: none; cursor: pointer; transition: color 0.2s; }
    .action-btn:hover { color: #4b2995; text-decoration: underline; }
    .action-btn:disabled { color: #9ca3af; cursor: not-allowed; text-decoration: none; }
    .report-btn { font-size: 0.8rem; color: #ef4444; }
    .report-btn:hover { color: #b91c1c; text-decoration: underline; }
    .frase-inspiradora { color: #6D28D9; font-weight: 500; font-style: italic; margin-bottom: 0.5rem; display: block; transition: color 0.3s; min-height: 1.5rem;}
    .stats-box { margin-top: 1rem; background: #F0FFF4; border-radius: 0.75rem; padding: 1rem; border: 1px solid #C6F6D5; }
    .stats-box .titulo { font-weight: 600; color: #2F855A; margin-bottom: 0.2rem; }
    .stats-box .dato { font-size: 1.07rem; font-weight: 500; color: #2D3748; margin-bottom: 0.1rem; }
    .stats-box .dato strong { color: #2F855A; }
    .estadisticas-anonimas { margin-top: 1.5rem; background: #F3F0FF; border-radius: 0.75rem; padding: 1rem; }
    .estadisticas-anonimas .titulo { font-weight: 600; color: #6D28D9; margin-bottom: 0.2rem; }
    .estadisticas-anonimas .dato { font-size: 1.07rem; font-weight: 500; color: #2D3748; margin-bottom: 0.1rem; }
    .estadisticas-anonimas .dato strong { color: #6D28D9; }
    .badge-notif { display: inline-block; min-width: 16px; background: #ef4444; color: #fff; border-radius: 9999px; font-size: 0.8rem; padding: 2px 8px; position: absolute; top: -6px; right: -10px; z-index: 10; box-shadow: 0 0 4px #ef4444aa; }
    .revelation-answer { border-left: 3px solid #a78bfa; padding-left: 1rem; margin-top: 1rem; }
    @keyframes pulse-and-rotate { 0% { transform: scale(1) rotate(0deg); } 5% { transform: scale(1.2) rotate(-15deg); } 10% { transform: scale(1) rotate(0deg); } 100% { transform: scale(1) rotate(0deg); } }
    #randomThoughtGlobe { cursor: pointer; display: inline-block; animation: pulse-and-rotate 5s infinite; transition: transform 0.3s ease-in-out; }
    #randomThoughtGlobe:hover { animation-play-state: paused; transform: scale(1.2) rotate(-15deg); }
    #notification-area { position: fixed; top: 20px; right: 20px; z-index: 10000; display: flex; flex-direction: column; gap: 10px; }
    .notification { padding: 1rem; border-radius: 0.5rem; color: white; font-weight: 500; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.5s ease; opacity: 0; transform: translateX(100%); }
    .notification.show { opacity: 1; transform: translateX(0); }
    .notification.success { background-color: #28a745; }
    .notification.error { background-color: #dc3545; }
    .notification.info { background-color: #17a2b8; }
    .legal-section h3 { font-size: 1.25rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.5rem; border-bottom: 1px solid #ddd; padding-bottom: 0.25rem; }
    .legal-section p, .legal-section ul { margin-bottom: 1rem; text-align: justify; }
    .legal-section li { margin-bottom: 0.5rem; }
    .empty-state { text-align: center; padding: 2rem 1rem; font-size: 0.9rem; color: #718096; }
    .floating-banner { position: fixed; bottom: 0; left: 0; right: 0; background: #1f2937; color: white; padding: 1rem; text-align: center; z-index: 50; box-shadow: 0 -2px 10px rgba(0,0,0,0.2); transform: translateY(100%); transition: transform 0.3s ease-in-out; }
    .floating-banner.show { transform: translateY(0); }
    
    /* ---- ESTILOS MINIMALISTAS PARA EL SELECTOR DE IDIOMA ---- */
    .lang-selector a {
        margin: 0 0.5rem;
        text-decoration: none;
        color: #6b7280; /* Gris para el idioma inactivo */
        font-weight: normal;
        transition: color 0.2s;
    }
    .lang-selector a:hover {
        color: #111827; /* M√°s oscuro al pasar el rat√≥n */
        text-decoration: underline;
    }
    .lang-selector a.active {
        color: #4f46e5; /* Color √≠ndigo para el idioma activo */
        font-weight: bold;
        cursor: default;
    }
    .lang-selector a.active:hover {
        text-decoration: none; /* Evitar subrayado en el idioma activo */
    }

    @media (max-width: 640px) { .estadisticas-anonimas, .stats-box { font-size: 0.97rem; } }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen flex flex-col items-center p-4">

  <div id="notification-area"></div>

  <header class="mb-6 text-center w-full max-w-xl">
    <div id="logoContainer" class="relative h-16 mt-6 text-3xl font-semibold flex items-center justify-center">
      <h1 id="textLogo" class="absolute logo-shown">LIBRE</h1>
      <img id="logolibre" src="logolibre.png" alt="LIBRE logo" class="absolute w-8 h-8" />
    </div>
    <p class="mt-1 text-[0.77rem] font-medium whitespace-normal" data-translate-key="header.subtitle">Escribe lo que quieras, sin esperar nada a cambio.<br>Tus palabras ser√°n una botella lanzada al mar, encontrada por alguien en alg√∫n lugar del mundo, sin saber qui√©n eres, ni qui√©n la encontr√≥.</p>
    <div class="mt-4 text-lg font-medium">
      <span id="globalCount">üåê <span id="globalCountNum">0</span> <span data-translate-key="header.global_count">pensamientos lanzados</span></span>
    </div>
  </header>

  <nav class="w-full max-w-xl flex justify-around mb-6 text-sm relative">
    <button onclick="showTab('feed')" class="hover:underline" data-translate-key="nav.global_thoughts">Pensamientos globales</button>
    <button onclick="showTab('revelacion')" class="hover:underline" data-translate-key="nav.daily_revelation">Revelaci√≥n Diaria</button>
    <button onclick="showTab('mine')" class="hover:underline relative">
      <span data-translate-key="nav.my_thoughts">Mis pensamientos</span>
      <span id="mineTabNotification" class="badge-notif hidden" data-translate-key="nav.new_badge">¬°Nuevo!</span>
    </button>
    <button onclick="showTab('capsule')" class="hover:underline" data-translate-key="nav.time_capsule">C√°psula del tiempo</button>
  </nav>

  <main class="w-full">
    <section id="feed" class="w-full max-w-xl mx-auto mb-8">
      <div class="rounded-2xl bg-blue-100 border border-blue-300 p-6 shadow-md relative">
        <div class="flex items-center mb-4">
          <h2 class="text-2xl font-semibold text-blue-800 flex items-center">
              <span id="randomThoughtGlobe" title="Ver un pensamiento aleatorio del mundo" class="text-3xl mr-2" data-translate-key-title="feed.title_tooltip">üåç</span>
              <span data-translate-key="feed.title">Pensamientos de todo el mundo</span>
          </h2>
        </div>
        <details class="mb-6">
          <summary class="font-medium cursor-pointer text-blue-800" data-translate-key="feed.details_summary">Ver mapa, ranking y estad√≠sticas</summary>
          <div class="mt-2">
            <div id="map"></div>
            <div id="countryRanking" class="mb-4"></div>
            <div id="estadisticasAnonimas" class="estadisticas-anonimas" style="display: none;"></div>
          </div>
        </details>
        <div id="write" class="w-full mb-6">
          <textarea id="textarea" class="w-full p-4 rounded-xl shadow-inner bg-white border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400" rows="4" maxlength="500" data-translate-key-placeholder="feed.textarea_placeholder"></textarea>
          <button id="sendBtn" class="mt-2 w-full text-center py-3 rounded-xl font-medium bg-blue-500 text-white hover:bg-blue-600 shadow-md hover:shadow-xl transition" data-translate-key="feed.send_button">Enviar pensamiento</button>
        </div>
        <div id="randomThought" class="p-4 bg-white rounded-lg shadow-sm mb-4 hidden"></div>
        <div id="globalThoughts" class="space-y-4"></div>
        <div id="globalPagination" class="pagination"></div>
      </div>
    </section>

    <section id="revelacion" class="w-full max-w-xl mx-auto mb-8 hidden">
      <div class="rounded-2xl bg-purple-100 border border-purple-300 p-6 shadow-md relative">
          <div class="flex items-center mb-4">
              <span class="text-3xl mr-2">üåå</span>
              <h2 class="text-2xl font-semibold text-purple-800" data-translate-key="revelation.title">Revelaci√≥n Diaria</h2>
          </div>
          <p class="text-sm text-purple-900 mb-4" data-translate-key="revelation.subtitle">Cada d√≠a, una nueva pregunta. Responde a ciegas y vuelve ma√±ana para ver las respuestas an√≥nimas de todo el mundo.</p>
          <div id="revelacionHoy">
              <h3 class="font-semibold text-lg text-purple-800 mb-2" data-translate-key="revelation.todays_question">Pregunta de Hoy:</h3>
              <p id="revelacionQuestion" class="font-medium text-lg mb-4 p-4 bg-purple-50 rounded-lg"></p>
              <div id="revelacionInputArea">
                  <textarea id="revelacionTextarea" class="w-full p-4 rounded-xl shadow-inner bg-white border border-gray-300 focus:outline-none focus:ring-2 focus:ring-purple-400" rows="4" maxlength="500" data-translate-key-placeholder="revelation.textarea_placeholder"></textarea>
                  <button id="revelacionSendBtn" class="mt-2 w-full text-center py-3 rounded-xl font-medium bg-purple-500 text-white hover:bg-purple-600 shadow-md transition" data-translate-key="revelation.send_button">Enviar respuesta</button>
              </div>
              <div id="revelacionThanks" class="hidden p-4 bg-purple-200 rounded-lg text-center font-medium text-purple-900">
                  <p data-translate-key="revelation.thanks_message">Gracias por tu contribuci√≥n.</p>
                  <p class="text-sm mt-2" data-translate-key="revelation.next_revelation_in">La pr√≥xima revelaci√≥n comenzar√° en:</p>
                  <p id="revelacionCountdown" class="text-2xl font-bold mt-1">--:--:--</p>
              </div>
          </div>
          <div class="mt-8">
              <button onclick="showYesterdaysRevelation()" class="text-purple-600 font-semibold hover:underline" data-translate-key="revelation.view_yesterday">Ver la revelaci√≥n de ayer ‚Üí</button>
              <div id="revelacionAyerContainer" class="mt-4 hidden">
                  <h3 id="revelacionAyerQuestion" class="font-semibold text-lg text-purple-800 mb-2"></h3>
                  <div id="revelacionAyerRespuestas" class="space-y-4"></div>
              </div>
          </div>
      </div>
    </section>

    <section id="mine" class="w-full max-w-xl mx-auto mb-8 hidden">
      <div class="rounded-2xl bg-green-100 border border-green-300 p-6 shadow-md relative">
        <div class="flex items-center mb-4">
          <span class="text-3xl mr-2">üìú</span>
          <h2 class="text-2xl font-semibold text-green-800" data-translate-key="mine.title">Mi Universo Personal</h2>
        </div>

        <div id="personalStats" class="stats-box mb-6"></div>

        <div class="flex mb-3">
          <button onclick="exportAnonId()" class="px-3 py-1 rounded bg-gray-300 mr-2 text-sm" data-translate-key="mine.export_id_button">Exportar ID</button>
          <button onclick="importAnonId()" class="px-3 py-1 rounded bg-gray-300 text-sm" data-translate-key="mine.import_id_button">Importar ID</button>
        </div>
        <div class="mb-4 text-xs text-green-900 opacity-60" data-translate-key="mine.id_info">Para mantener tu historial aunque borres cach√© o cambies de dispositivo, exporta tu ID y gu√°rdalo en un lugar seguro.</div>
        
        <h3 class="text-lg font-semibold text-green-800 mb-3" data-translate-key="mine.history_title">Mi Historial de Pensamientos</h3>
        <div id="myThoughts" class="space-y-4"></div>
        <div id="myPagination" class="pagination"></div>
      </div>
    </section>

    <section id="capsule" class="w-full max-w-xl mx-auto mb-8 hidden">
      <div class="rounded-2xl bg-blue-100 border border-blue-300 p-6 shadow-md relative">
        <div class="flex items-center mb-4">
          <span class="text-3xl mr-2">üöÄ</span>
          <h2 class="text-2xl font-semibold text-blue-800" data-translate-key="capsule.title">C√°psula del tiempo</h2>
        </div>
        <p class="mt-1 text-sm font-medium text-blue-900 mb-4" data-translate-key="capsule.subtitle">Un eco de tus pensamientos, viajando silenciosamente hacia un rinc√≥n lejano del ma√±ana.</p>
        <textarea id="capsuleMessage" class="w-full mt-2 p-4 rounded-xl shadow-inner bg-white border border-blue-300 focus:outline-none focus:ring-2 focus:ring-blue-300" rows="4" maxlength="500" data-translate-key-placeholder="capsule.textarea_placeholder"></textarea>
        <div class="flex space-x-2 mt-3">
          <input type="date" id="capsuleDate" class="p-2 rounded-lg bg-white border border-blue-300 focus:outline-none">
          <input type="time" id="capsuleTime" class="p-2 rounded-lg bg-white border border-blue-300 focus:outline-none">
          <button id="capsuleBtn" class="px-4 py-2 rounded-lg bg-blue-500 text-white shadow-md hover:bg-blue-600 transition" data-translate-key="capsule.schedule_button">Programar</button>
        </div>
        <div id="capsulesList" class="mt-6 space-y-4"></div>
      </div>
    </section>

    <section id="about" class="w-full max-w-2xl mx-auto mb-8 hidden legal-section">
      <!-- El contenido de esta secci√≥n es est√°tico y no se traducir√° por ahora para mantener la simplicidad -->
      <div class="rounded-2xl bg-yellow-50 border border-yellow-200 p-6 sm:p-8 shadow-md relative">
        <h2 class="text-2xl font-semibold text-black mb-6 text-center">Informaci√≥n y Aspectos Legales</h2>
        <details open>
          <summary class="text-lg font-semibold cursor-pointer mb-2">¬øPor qu√© Libre?</summary>
          <ul class="list-disc pl-5 text-sm sm:text-base">
            <li><b>Anonimato radical:</b> Nadie te sigue, nadie sabe qui√©n eres. Tu identidad no importa, solo tu pensamiento.</li>
            <li><b>Sin validaci√≥n social:</b> No hay ‚Äúme gusta‚Äù, ni seguidores, ni comentarios p√∫blicos que te condicionen.</li>
            <li><b>Libertad de expresi√≥n pura:</b> Un espacio para soltar lo que llevas dentro, sin miedo a juicios ni presi√≥n social.</li>
            <li><b>Conexi√≥n humana inesperada:</b> Tu mensaje puede llegar a cualquier persona, en cualquier pa√≠s, en cualquier momento.</li>
            <li><b>Sin historial, sin reputaci√≥n:</b> Cada mensaje es un instante aislado, sin contexto previo ni futuro.</li>
            <li><b>Cero algoritmos, cero manipulaci√≥n:</b> No hay feeds personalizados, ni trending topics. Todo es azar.</li>
          </ul>
        </details>
        <div id="terms" class="mt-6">
          <h3 class="text-xl font-semibold mb-3">T√©rminos de Servicio</h3>
          <p>Al utilizar LIBRE (el "Servicio"), aceptas cumplir con estos T√©rminos de Servicio. El acceso y uso del Servicio est√°n condicionados a tu aceptaci√≥n y cumplimiento de estos t√©rminos.</p>
          <ul class="list-disc pl-5">
              <li><strong>Requisito de Edad:</strong> Debes tener al menos 16 a√±os para utilizar este Servicio. Al acceder o utilizar LIBRE, declaras y garantizas que cumples con este requisito de edad. No recopilamos deliberadamente informaci√≥n de personas menores de 16 a√±os.</li>
              <li><strong>Contenido del Usuario:</strong> Eres el √∫nico responsable del contenido que publicas. Al publicar contenido, garantizas que tienes derecho a hacerlo y que no infringe ninguna ley ni los derechos de terceros. No publiques contenido que sea ilegal, ofensivo, amenazante, difamatorio, que incite al odio o que viole cualquier ley o regulaci√≥n.</li>
              <li><strong>Conducta del Usuario:</strong> Aceptas no utilizar el Servicio para ning√∫n prop√≥sito ilegal o no autorizado. El acoso, el spam y cualquier forma de abuso est√°n estrictamente prohibidos.</li>
              <li><strong>Moderaci√≥n de Contenido:</strong> Nos reservamos el derecho, pero no la obligaci√≥n, de monitorear y eliminar contenido que, a nuestra entera discreci√≥n, viole estos t√©rminos o sea inapropiado. El sistema de reportes por parte de la comunidad es una herramienta clave para mantener la plataforma segura.</li>
              <li><strong>Limitaci√≥n de Responsabilidad:</strong> El Servicio se proporciona "tal cual", sin garant√≠as de ning√∫n tipo. No seremos responsables de ning√∫n da√±o directo o indirecto que surja de tu uso del Servicio.</li>
          </ul>
        </div>
        <div id="privacy" class="mt-6">
          <h3 class="text-xl font-semibold mb-3">Pol√≠tica de Privacidad</h3>
          <p>Tu privacidad es el pilar fundamental de LIBRE. Esta pol√≠tica explica qu√© informaci√≥n se recopila y c√≥mo se utiliza para mantener el anonimato.</p>
          <ul class="list-disc pl-5">
              <li><strong>Anonimato:</strong> El Servicio est√° dise√±ado para ser radicalmente an√≥nimo. No se te solicita ni se almacena ninguna informaci√≥n de identificaci√≥n personal (nombre, correo electr√≥nico, etc.).</li>
              <li><strong>Datos Recopilados:</strong>
                  <ul>
                      <li><strong>Identificador An√≥nimo:</strong> Al usar el servicio, se genera un identificador √∫nico y an√≥nimo (ej: `anon-xxxxxx`) que se guarda en el almacenamiento local (`localStorage`) de tu navegador. Este ID te permite ver tu historial de mensajes, pero no est√° vinculado a tu identidad real. Si borras los datos de tu navegador, este ID se perder√° a menos que lo hayas exportado.</li>
                      <li><strong>Pa√≠s:</strong> Para fines estad√≠sticos y para mostrar la procedencia de los mensajes en el mapa, detectamos tu pa√≠s a trav√©s de tu direcci√≥n IP. La direcci√≥n IP en s√≠ misma **no se almacena en ning√∫n momento**. Solo se guarda el c√≥digo del pa√≠s (ej: "ES" para Espa√±a) junto con el mensaje.</li>
                  </ul>
              </li>
              <li><strong>Uso de Almacenamiento Local (`localStorage`):</strong> Utilizamos el almacenamiento local de tu navegador para:
                  <ul>
                      <li>Guardar tu identificador an√≥nimo.</li>
                      <li>Recordar si has aceptado el aviso de edad, para no mostr√°rtelo de nuevo.</li>
                      <li>Registrar los √∫ltimos mensajes respondidos para el sistema de notificaciones.</li>
                  </ul>
              </li>
              <li><strong>No Compartimos Datos:</strong> Dado que no recopilamos datos personales, no hay nada que compartir o vender a terceros.</li>
          </ul>
        </div>
      </div>
    </section>
  </main>

  <footer class="w-full max-w-xl mx-auto text-center py-6">
    <p class="mb-4 text-sm font-medium" data-translate-key="footer.support_text">Si te gusta Libre, ap√≥yanos en Ko-fi:</p>
    <a href="https://ko-fi.com/libreantisocial" target="_blank" class="inline-block px-6 py-2 bg-yellow-400 rounded-full font-medium shadow hover:shadow-lg transition" data-translate-key="footer.support_button">‚òï Ap√≥yanos</a>
    <div class="mt-6 text-sm text-gray-600">
      <div class="flex justify-center items-center space-x-4">
          <button onclick="showLegalSection('terms')" class="hover:underline" data-translate-key="footer.terms">T√©rminos de Servicio</button>
          <span>‚Ä¢</span>
          <button onclick="showLegalSection('privacy')" class="hover:underline" data-translate-key="footer.privacy">Pol√≠tica de Privacidad</button>
      </div>
      <div class="mt-4 lang-selector">
        <a href="#" onclick="setLanguage('es')" id="lang-es">Espa√±ol</a>
        <a href="#" onclick="setLanguage('en')" id="lang-en">English</a>
      </div>
      <p class="mt-3"><span data-translate-key="footer.contact">Contacto:</span> <a href="mailto:libreantisocial@gmail.com" class="text-blue-600 hover:underline">libreantisocial@gmail.com</a></p>
      <p class="mt-3 opacity-80">¬© 2025 Libre</p>
    </div>
  </footer>

  <div id="ageGateBanner" class="floating-banner">
      <p class="text-sm">
        <span data-translate-key="age_gate.text">LIBRE es una comunidad para **mayores de 16 a√±os**. Al continuar, confirmas que cumples este requisito.</span>
        <button onclick="showLegalSection('terms')" class="underline font-semibold" data-translate-key="age_gate.learn_more">Saber m√°s</button>
      </p>
      <button id="ageGateAccept" class="mt-2 px-5 py-1 bg-blue-500 rounded-full font-semibold hover:bg-blue-600 transition-colors" data-translate-key="age_gate.accept_button">Entendido</button>
  </div>

  <div id="langBanner" class="floating-banner">
    <p class="mb-2 font-semibold" data-translate-key="lang_banner.text">Elige tu idioma:</p>
    <div class="flex justify-center space-x-4">
      <button id="langBannerEs" class="px-5 py-1 bg-indigo-600 rounded-full font-semibold hover:bg-indigo-700 transition-colors" data-translate-key="lang_banner.button_es">Espa√±ol</button>
      <button id="langBannerEn" class="px-5 py-1 bg-indigo-600 rounded-full font-semibold hover:bg-indigo-700 transition-colors" data-translate-key="lang_banner.button_en">English</button>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="badwords.js"></script>
  <script src="translations.js"></script>
  <script src="app-v2.js"></script>
</body>
</html>